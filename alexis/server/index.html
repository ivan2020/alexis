<!DOCTYPE html>
<html>
<head>
    <title>alexis</title>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">
        $(function () {
            var $result = $("#result");
            var $error = $("#error");

            var reset = function () {
                $error.text("");
                $result.children().remove();
            };

            var addError = function (error) {
                $error.text(error);
            };

            var addCountry = function (country) {
                var $country = $("<div></div>");
                $result.append($country);
                var $title = $("<h2></h2>").text(country.name);
                $country.append($title);

                for (var i = 0; i < country.hotels.length; i++) {
                    addHotel($country, country.hotels[i]);
                }
            };

            var addHotel = function ($country, hotel) {
                var img = "";

                console.log(hotel);

                if (hotel.photos.length > 0) {
                    img = '<img src="' + hotel.photos[0].url + '">';
                }

                var $hotel = $("<div><h3>" + hotel.name + "</h3>" + img + "</div>");
                $country.append($hotel);
            };

            $("#search-form").submit(function (e) {
                $.ajax({
                    cache:false,
                    data:{"query":$("#query").val()},
                    dataType:"json",
                    success:function (data) {
                        reset();

                        if (typeof data.error != "undefined") {
                            addError(data.error);
                        }

                        if (typeof data.countries != "undefined") {
                            for (var i = 0; i < data.countries.length; i++) {
                                addCountry(data.countries[i]);
                            }
                        }
                    },
                    type:"POST",
                    url:"/search-requests"
                });

                e.preventDefault();
            });
        });
    </script>
</head>
<body>
<form id="search-form">
    <input id="query">
</form>
<h2 id="error"></h2>

<div id="result"></div>
</body>
</html>
